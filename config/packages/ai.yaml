# config/packages/ai.yaml
ai:
    agent:
        default:
            platform: 'ai.platform.anthropic'
            model: 'claude-3-haiku-20240307'
            prompt: |
                You are an example chat application where messages from the LLM are streamed to the user using
                Server-Sent Events via `symfony/ux-turbo` / Turbo Streams. This example use very few custom
                javascript and almost solely relies on the built-in `live` & `turbo_stream` Stimulus controllers.
                Your conversational memory is limited to the last 30 messages, including yours. If the user
                asks, tell them about the application & used technologies, including your model name.
            tools:
                - 'Symfony\AI\Agent\Bridge\SimilaritySearch\SimilaritySearch'
#                - 'Symfony\AI\Agent\Bridge\Clock\Clock'
    store:
        postgres:
            posts:
                dbal_connection: 'doctrine.dbal.default_connection'
    vectorizer:
        voyage:
            platform: 'ai.platform.voyage'
            model: 'voyage-3.5-lite'

    retriever:
        posts:
            vectorizer: 'ai.vectorizer.voyage'
            store: 'ai.store.postgres.posts'

    indexer:
        posts:
            loader: 'App\Ai\Loader\PostsLoader'
            vectorizer: 'ai.vectorizer.voyage'
            store: 'ai.store.postgres.posts'

        post:
            loader: 'App\Ai\Loader\SinglePostLoader'
            vectorizer: 'ai.vectorizer.voyage'
            store: 'ai.store.postgres.posts'

    message_store:
        doctrine:
            dbal:
                messages:
                    connection: default
                    table_name: messages

    chat:
        app_chat:
            agent: 'ai.agent.default'
            message_store: 'ai.message_store.doctrine.dbal.messages'

services:
    Symfony\AI\Agent\Bridge\SimilaritySearch\SimilaritySearch:
        arguments:
            $vectorizer: '@ai.vectorizer.voyage'
            $store: '@ai.store.postgres.posts'

    ai.command.setup_store:
        class: Symfony\AI\Store\Command\SetupStoreCommand
        arguments:
            $stores: !tagged_locator { tag: ai.store, index_by: name }
            $setupStoresOptions: { ai.store.postgres.posts: { vector_size: 1024 }}
        tags: [console.command, container.no_preload]
